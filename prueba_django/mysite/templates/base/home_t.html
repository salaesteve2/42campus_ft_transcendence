<!DOCTYPE html>
<html>
{% load i18n %}
<head>
<meta charset="UTF-8"/>
<!--<link rel="stylesheet" href="static/base.css">-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../../static/base.css">

<!-- href="static/base.css"/>-->
<link rel="icon" type="image/x-icon" href="static/favicon.ico">
<meta http-equiv="refresh" content="5">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<!-- MENU NAVIGATION BAR -->
{% if request.user.is_authenticated %}
<div class="navigation">
  <ul>
    <li class="list">
      <a href="{% url 'home' %}" onclick="showPage('home')">
        <span class="icon"><ion-icon name="home"></ion-icon></span>
        <span class="text">home</span>
      </a>
    </li>
    <li class="list" >
      <a href="{% url 'arranque_rapido' %}" onclick="showPage('game')">
        <span class="icon"><ion-icon name="logo-game-controller-a"></ion-icon></span>
        <span class="text">game</span>
      </a>
    </li>
    <li class="list">
      <a href="#" onclick="showPage('live')">
        <span class="icon"><ion-icon name="pulse"></ion-icon></span>
        <span class="text">live</span>
      </a>
    </li>
    <li class="list">
      <a href="{% url 'partidos_list' %}" onclick="showPage('stats')">
        <span class="icon"><ion-icon name="stats"></ion-icon></span>
        <span class="text">stats</span>
      </a>
    </li>
    <li class="list">
      <a href="#" onclick="showPage('settings')">
        <span class="icon"><ion-icon name="settings"></ion-icon></span>
        <span class="text">options</span>
      </a>
    </li>
    <li class="list">
      <a href="#" onclick="showPage('usrprofile')">
        <span class="icon"><ion-icon name="people"></ion-icon></span>
        <span class="text">profile</span>
      </a>
    </li>
  </ul>
{% endif %}
  <p>
    <a href="{% url 'en' %}">English</a>&nbsp;&nbsp;&nbsp;
    <a href="{% url 'es' %}">Español</a>&nbsp;&nbsp;&nbsp;
    <a href="{% url 'fr' %}">Français</a>
  </p>
</div>


 <!-- PRIMARY CONTENT SECTION -->
      <!-- en esta seccion se abren diferentes divs para albergar todas las páginas del sitio
           en un site mono página -->
<main>
  <div id="home" class="page">
    <div class="container">
<h1>{% trans "Pong game" %}</h1>

{% if request.user.is_authenticated %}
  <p>{% trans "User" %}: {{ request.user.username }}</p>
  <p><a href="{% url 'logout' %}">{% trans "Logout" %}</a></p>
  <form id="2faForm" action="{% url '2fa' %}" method="post">
    {% csrf_token %}
    <input type="checkbox" id="activate_2fa" name="activate_2fa" />
    <label for="activate_2fa">Activar 2FA</label><br>
  </form>
  <table width='250'>
    <tr><th>{% trans "Quick match" %}</th></tr>
    <tr>
      <td>
        <p><a href="{% url 'arranque_rapido' %}">{% trans "Play" %}</a></p>
        <p><a href="{% url 'partidos_mlist' %}">{% trans "List of my matches" %}</a></p>
        <p><a href="{% url 'partidos_list' %}">{% trans "List of matches" %}</a></p>
      </td>
    </tr>
  </table>
  <table width='250'>
    <tr><th>{% trans "Tournaments" %}</th></tr>
    <tr>
      <td>
        <p><a href="{% url 'torneos_inscripcion_list' %}">{% trans "Tournament registration" %}</a></p>
        <p><a href="{% url 'torneos_info_list' %}">{% trans "Tournament information" %}</a></p -->
        {% if jugar %}
          <p><a href="{% url 'arranque_torneo' %}">{% trans "Tournament play" %}</a></p>
        {% endif %}
        {% if hayProximosTorneos %}
        <p>{% trans "Upcoming tournaments" %}</p>
        <ul>
        {% for t_torneo in proximosTorneos %}
          <li>{{ t_torneo }}</li>
        {% endfor %}
        </ul>
        {% endif %}
        {% if request.user.is_superuser or request.user.is_staff %}
           <p><a href="torneos_admin">{% trans "Tournament administration" %}</a></p>
           <!-- <p><a href="torneos_mantenimiento">mantenimiento</a></p> -->
        {% endif %}
      </td>
    </tr>
  </table>
{% else %}
<!-- esta es la parte que se vé cuando no estamos logueados -->
  <p><a href="{% url 'login' %}">{% trans "Login" %}</a></p>
  <p><a href="{% url 'signup' %}">{% trans "Signup" %}</a></p>
  <p><a href="https://api.intra.42.fr/oauth/authorize?client_id=u-s4t2ud-22fb4fcdf0439caa173afadfabf30acd4f9721420251db03960f190416055657&redirect_uri=https%3A%2F%2Flocalhost%2Fapi&response_type=code">{% trans "42Login" %}</a></p>
{% endif %}

</div>
</div>
<script>
  $(document).ready(function() {

      // Enviar una solicitud al backend para obtener el estado actual de 2FA
      $.ajax({
          url: '{% url "check" %}',  // URL para obtener el estado actual de 2FA
          method: 'GET',
          success: function(response) {
              // Verificar si el 2FA está activado y marcar el checkbox en consecuencia
              if (response.double_factor_auth_enabled) {
                  $('#activate_2fa').prop('checked', true);
              }
          },
          error: function(xhr, errmsg, err) {
              console.error('Error al obtener el estado de 2FA:', errmsg);
          }
      });
  
      $('#activate_2fa').change(function() {
          // Obtener el estado del checkbox
          var isChecked = $(this).is(':checked');
          
          // Enviar solicitud al backend usando AJAX
          $.ajax({
              url: $('#2faForm').attr('action'),
              method: 'POST',
              data: { activate_2fa: isChecked },
              headers: { "X-CSRFToken": "{{ csrf_token }}" }, // Asegúrate de enviar el token CSRF
              success: function(response) {
                  console.log('Estado de 2FA actualizado correctamente.');
              },
              error: function(xhr, errmsg, err) {
                  console.error('Error al actualizar el estado de 2FA:', errmsg);
              }
          });
      });
  });
  </script>
</main>
<footer>
  (c) 42Madrid excentric pong
</footer>



</body>
</html>
